steps:
  - name: gcr.io/cloud-builders/yarn
    args: ['install']
  # - name: gcr.io/cloud-builders/yarn
  #   args: ["test"]
  - name: gcr.io/cloud-builders/yarn
    args: ['create-env']
    env:
      - 'COOKIE_SESSION_KEY=${_COOKIE_SESSION_KEY}'
      - 'DISCORD_BOT_SECRET=${_DISCORD_BOT_SECRET}'
      - 'DISCORD_CLIENT_ID=${_DISCORD_CLIENT_ID}'
      - 'DISCORD_CLIENT_SECRET=${_DISCORD_CLIENT_SECRET}'
      - 'DISCORD_GUILD=${_DISCORD_GUILD}'
      - 'DISCORD_GUILD_ID=${_DISCORD_GUILD_ID}'
      - 'DISCORD_REDIRECT=${_DISCORD_REDIRECT}'
      - 'MONGO_DB=${_MONGO_DB}'
      - 'PORT=3001'
  - name: gcr.io/cloud-builders/yarn
    args: ['build']
  - name: gcr.io/cloud-builders/yarn
    args: ['deploy-only-no-promote:production']
timeout: '1600s'
